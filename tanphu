--==================================================
-- â³ TANPHU PETS FINDER v9.6 + SIDE UI 10MÂ±
--   â€¢ CHá»ˆ brainrot trong targets
--   â€¢ 1Mâ€“50M  â†’ UI + Auto Join + webhook_high
--   â€¢ >50M    â†’ CHá»ˆ webhook_over50 (khÃ´ng UI, khÃ´ng Auto Join)
--   â€¢ Side UI (báº¥m viá»n trÃ¡i "PF") hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng 10M+ / 10M-
--   â€¢ QuÃ©t liÃªn tá»¥c, ngÆ°á»i join sau váº«n bá»‹ quÃ©t
--==================================================
repeat task.wait() until game:IsLoaded()

if _G.TanPhuPetsFinder_v9_6_Loaded then
    warn("[PetsFinder] Script Ä‘Ã£ cháº¡y, khÃ´ng cháº¡y láº¡i.")
    return
end
_G.TanPhuPetsFinder_v9_6_Loaded = true

local Players         = game:GetService("Players")
local HttpService     = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer     = Players.LocalPlayer

-- HTTP impl
local http_request_impl =
    (typeof(syn) == "table" and typeof(syn.request) == "function" and syn.request)
    or (typeof(http_request) == "function" and http_request)
    or (typeof(request) == "function" and request)
    or (typeof(http) == "table" and typeof(http.request) == "function" and http.request)

if not http_request_impl then
    warn("[PetsFinder] âŒ KhÃ´ng tÃ¬m tháº¥y HTTP request.")
    return
end

local function sendWebhook(url, payload)
    local ok, err = pcall(function()
        http_request_impl({
            Url = url,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode(payload)
        })
    end)
    if not ok then
        warn("[PetsFinder] HTTP error:", err)
    end
end

--==================================================
-- ðŸŽ¯ TARGET LIST (brainrot ONLY)
--==================================================
local targets = {
    'Chipso and Queso','La Casa Boo','Tang Tang Keletang','Headless Horseman',
    'Strawberry Elephant','Chicleteira Bicicleteira','Los Chicleteiras',
    'La Grande Combinasion','Nuclearo Dinossauro','Esok Sekolah','Ketupat Kepat',
    'Money Money Puggy','Tictac Sahur','Ketchuru and Musturu','Garama and Madundung',
    'Spaghetti Tualetti','Dragon Cannelloni','67','Mariachi Corazoni','Tacorita Bicicleta',
    'La Extinct Grande','Las Sis',
    'Celularcini Viciosini','Los Bros','Tralaledon','Los Tacoritas','Los Primos',
    'Chillin Chili','Los Combinasionas','Los Hotspotsitos','La Supreme Combinasion',
    'Los 67','La Secret Combinasion','Burguro And Fryuro','La Spooky Grande','Los Mobilis',
    'Eviledon','Spooky and Pumpky','Mieteteira Bicicleteira','Los Spooky Combinasionas','Meowl',
    'Los Matteos','Bisonte Guppitere','La Vacca Saturno Saturnita','Los Spiderinis','Los Tralaleritos',
    'Yess My Examine','Las Tralaleritas','Job Job Job Sahur','Las Vaquitas Saturnitas','1x1x1x1','Guest 666',
    'Captiano Moby','La Taco Combinasion','Los Puggies','Los Spaghettis','Fragrama and Chocrama','Orcaledon','Swag Soda'
}

local targetsLower = {}
for _, t in ipairs(targets) do
    table.insert(targetsLower, string.lower(t))
end

-- Tráº£ vá» tÃªn brainrot náº¿u model chá»©a 1 trong cÃ¡c tÃªn targets
local function detectBrainrotName(model)
    if not model then return nil end

    -- check tÃªn model
    local nameLower = string.lower(model.Name or "")
    for i, tLower in ipairs(targetsLower) do
        if string.find(nameLower, tLower, 1, true) then
            return targets[i]
        end
    end

    -- check TextLabel/TextButton con
    for _, d in ipairs(model:GetDescendants()) do
        if d:IsA("TextLabel") or d:IsA("TextButton") then
            local txt = d.Text
            if txt and txt ~= "" then
                local l = string.lower(txt)
                for i, tLower in ipairs(targetsLower) do
                    if string.find(l, tLower, 1, true) then
                        return targets[i]
                    end
                end
            end
        end
    end

    return nil
end

--==================================================
-- ðŸ’° PARSE MPS
--==================================================
local function parseMps(raw)
    if raw == nil then return 0 end
    if typeof(raw) == "number" then
        return raw
    end

    local s = tostring(raw):gsub(",", ""):gsub("%s+", ""):upper()
    local num = tonumber(s:match("([%d%.]+)")) or 0

    if s:find("B") then
        return num * 1e9
    elseif s:find("M") then
        return num * 1e6
    elseif s:find("K") then
        return num * 1e3
    else
        return num
    end
end

local function formatMpsShort(v)
    v = tonumber(v) or 0
    if v >= 1e9 then
        return string.format("%.2fB", v/1e9)
    elseif v >= 1e6 then
        return string.format("%.2fM", v/1e6)
    elseif v >= 1e3 then
        return string.format("%.2fK", v/1e3)
    else
        return tostring(math.floor(v))
    end
end

--==================================================
-- NGÆ¯á» NG & WEBHOOK
--==================================================
local MIN_MPS       = 1_000_000      -- brainrot â‰¥1M má»›i bÃ¡o
local SPLIT_MPS     = 50_000_000     -- chia 50M
local TEN_MPS       = 10_000_000     -- ngÆ°á»¡ng 10M cho side UI

local webhook_high   = "https://discordapp.com/api/webhooks/1411329828904374293/elK3umTJvdL6h4ml-EHg9DbM1wCdQJFpOsNWEEB79T0P1hRstSgd_ep75KIp-aHdIdoK"
local webhook_over50 = "https://discordapp.com/api/webhooks/1410314122670903491/KD8clDHrbOMKlArHAoEyMXTqQGD6AAN7ftlYvdkFEOj5a9_VEGA9yqAhoH2XPK77TITb"

-- má»—i pet (Instance) 1 best MPS riÃªng, Ä‘á»ƒ khÃ´ng spam láº¡i náº¿u MPS khÃ´ng tÄƒng
local bestMpsPerPet = {}

--==================================================
-- SIDE UI 10M+ / 10M-
--==================================================
local countLow10   = 0   -- 1Mâ€“<10M
local countHigh10  = 0   -- â‰¥10Mâ€“â‰¤50M
local bucketByPet  = {}  -- pet -> "LOW" / "HIGH"

local sideLowLabel, sideHighLabel -- sáº½ gÃ¡n trong createUI

local function updateSideLabels()
    if sideLowLabel then
        sideLowLabel.Text = "10M-  : "..tostring(countLow10)
    end
    if sideHighLabel then
        sideHighLabel.Text = "10M+  : "..tostring(countHigh10)
    end
end

local function updateTenMBucket(pet, mps)
    local newBucket
    if mps >= TEN_MPS and mps <= SPLIT_MPS then
        newBucket = "HIGH"
    elseif mps >= MIN_MPS and mps < TEN_MPS then
        newBucket = "LOW"
    else
        newBucket = nil
    end

    local oldBucket = bucketByPet[pet]
    if oldBucket == newBucket then
        return
    end

    if oldBucket == "LOW" then
        countLow10 = math.max(0, countLow10 - 1)
    elseif oldBucket == "HIGH" then
        countHigh10 = math.max(0, countHigh10 - 1)
    end

    if newBucket == "LOW" then
        countLow10 = countLow10 + 1
    elseif newBucket == "HIGH" then
        countHigh10 = countHigh10 + 1
    end

    bucketByPet[pet] = newBucket
    updateSideLabels()
end

--==================================================
-- UI + AUTO JOIN (1Mâ€“50M, brainrot ONLY)
--==================================================
local autoJoinEnabled = false
local autoJoinedJobs  = {}

local function createUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "TanPhuPetsFinder"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    -- ===== MAIN FRAME =====
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 450, 0, 380)
    Frame.Position = UDim2.new(0.5, -225, 0.5, -190)
    Frame.BackgroundColor3 = Color3.fromRGB(15,15,18)
    Frame.BorderSizePixel = 0
    Frame.Active = true
    Frame.Draggable = true
    Frame.Parent = ScreenGui

    local FrameCorner = Instance.new("UICorner")
    FrameCorner.CornerRadius = UDim.new(0, 10)
    FrameCorner.Parent = Frame

    local FrameStroke = Instance.new("UIStroke")
    FrameStroke.Thickness = 1.5
    FrameStroke.Color = Color3.fromRGB(0, 180, 255)
    FrameStroke.Transparency = 0.4
    FrameStroke.Parent = Frame

    local TitleBar = Instance.new("Frame")
    TitleBar.Size = UDim2.new(1, 0, 0, 42)
    TitleBar.BackgroundColor3 = Color3.fromRGB(20,20,26)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = Frame

    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 10)
    TitleCorner.Parent = TitleBar

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -20, 1, 0)
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "TanPhu freehub | Pets Finder"
    Title.TextColor3 = Color3.fromRGB(0, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Title.Parent = TitleBar

    local TitleGradient = Instance.new("UIGradient")
    TitleGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 200)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 180, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 0, 255)),
    })
    TitleGradient.Parent = Title

    local ControlBar = Instance.new("Frame")
    ControlBar.Size = UDim2.new(1, -20, 0, 32)
    ControlBar.Position = UDim2.new(0, 10, 0, 48)
    ControlBar.BackgroundColor3 = Color3.fromRGB(19,19,24)
    ControlBar.BorderSizePixel = 0
    ControlBar.Parent = Frame

    local ControlCorner = Instance.new("UICorner")
    ControlCorner.CornerRadius = UDim.new(0, 8)
    ControlCorner.Parent = ControlBar

    local AutoJoinLabel = Instance.new("TextLabel")
    AutoJoinLabel.Size = UDim2.new(0, 120, 1, 0)
    AutoJoinLabel.Position = UDim2.new(0, 10, 0, 0)
    AutoJoinLabel.BackgroundTransparency = 1
    AutoJoinLabel.Text = "Auto Join:"
    AutoJoinLabel.Font = Enum.Font.GothamSemibold
    AutoJoinLabel.TextSize = 14
    AutoJoinLabel.TextColor3 = Color3.fromRGB(220,220,230)
    AutoJoinLabel.TextXAlignment = Enum.TextXAlignment.Left
    AutoJoinLabel.Parent = ControlBar

    local AutoJoinButton = Instance.new("TextButton")
    AutoJoinButton.Size = UDim2.new(0, 90, 0, 26)
    AutoJoinButton.Position = UDim2.new(0, 110, 0.5, -13)
    AutoJoinButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    AutoJoinButton.BorderSizePixel = 0
    AutoJoinButton.Text = "OFF"
    AutoJoinButton.Font = Enum.Font.GothamBold
    AutoJoinButton.TextSize = 14
    AutoJoinButton.TextColor3 = Color3.fromRGB(255,255,255)
    AutoJoinButton.Parent = ControlBar

    local AutoJoinCorner = Instance.new("UICorner")
    AutoJoinCorner.CornerRadius = UDim.new(0, 8)
    AutoJoinCorner.Parent = AutoJoinButton

    local AutoJoinStroke = Instance.new("UIStroke")
    AutoJoinStroke.Thickness = 1.4
    AutoJoinStroke.Color = Color3.fromRGB(200, 60, 60)
    AutoJoinStroke.Transparency = 0.2
    AutoJoinStroke.Parent = AutoJoinButton

    local function updateAutoJoinVisual()
        if autoJoinEnabled then
            AutoJoinButton.BackgroundColor3 = Color3.fromRGB(0, 170, 90)
            AutoJoinStroke.Color = Color3.fromRGB(0, 255, 140)
            AutoJoinButton.Text = "ON"
        else
            AutoJoinButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            AutoJoinStroke.Color = Color3.fromRGB(200, 60, 60)
            AutoJoinButton.Text = "OFF"
        end
    end
    updateAutoJoinVisual()

    AutoJoinButton.MouseButton1Click:Connect(function()
        autoJoinEnabled = not autoJoinEnabled
        updateAutoJoinVisual()
    end)

    local Scrolling = Instance.new("ScrollingFrame")
    Scrolling.Size = UDim2.new(1, -20, 1, -92)
    Scrolling.Position = UDim2.new(0, 10, 0, 88)
    Scrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    Scrolling.ScrollBarThickness = 6
    Scrolling.BackgroundColor3 = Color3.fromRGB(12,12,16)
    Scrolling.BackgroundTransparency = 0.1
    Scrolling.BorderSizePixel = 0
    Scrolling.Parent = Frame

    local ScrollingCorner = Instance.new("UICorner")
    ScrollingCorner.CornerRadius = UDim.new(0, 8)
    ScrollingCorner.Parent = Scrolling

    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Padding = UDim.new(0,8)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Parent = Scrolling

    UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Scrolling.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 20)
    end)

    -- ===== SIDE TOGGLE + SIDE FRAME 10M =====
    local SideToggle = Instance.new("TextButton")
    SideToggle.Size = UDim2.new(0, 26, 0, 80)
    SideToggle.Position = UDim2.new(0, 0, 0.5, -40)
    SideToggle.BackgroundColor3 = Color3.fromRGB(0, 160, 220)
    SideToggle.BorderSizePixel = 0
    SideToggle.Text = "PF"
    SideToggle.Font = Enum.Font.GothamBold
    SideToggle.TextSize = 16
    SideToggle.TextColor3 = Color3.fromRGB(255,255,255)
    SideToggle.Parent = ScreenGui

    local SideToggleCorner = Instance.new("UICorner")
    SideToggleCorner.CornerRadius = UDim.new(0, 6)
    SideToggleCorner.Parent = SideToggle

    local SideFrame = Instance.new("Frame")
    SideFrame.Size = UDim2.new(0, 180, 0, 90)
    SideFrame.Position = UDim2.new(0, 32, 0.5, -45)
    SideFrame.BackgroundColor3 = Color3.fromRGB(20,20,26)
    SideFrame.BorderSizePixel = 0
    SideFrame.Visible = false
    SideFrame.Parent = ScreenGui

    local SideCorner = Instance.new("UICorner")
    SideCorner.CornerRadius = UDim.new(0, 10)
    SideCorner.Parent = SideFrame

    local SideStroke = Instance.new("UIStroke")
    SideStroke.Thickness = 1.2
    SideStroke.Color = Color3.fromRGB(0, 200, 255)
    SideStroke.Transparency = 0.3
    SideStroke.Parent = SideFrame

    local SideTitle = Instance.new("TextLabel")
    SideTitle.Size = UDim2.new(1, -10, 0, 22)
    SideTitle.Position = UDim2.new(0, 5, 0, 4)
    SideTitle.BackgroundTransparency = 1
    SideTitle.Text = "Brainrot 10M stats"
    SideTitle.Font = Enum.Font.GothamSemibold
    SideTitle.TextSize = 14
    SideTitle.TextColor3 = Color3.fromRGB(200, 230, 255)
    SideTitle.TextXAlignment = Enum.TextXAlignment.Left
    SideTitle.Parent = SideFrame

    sideLowLabel = Instance.new("TextLabel")
    sideLowLabel.Size = UDim2.new(1, -10, 0, 24)
    sideLowLabel.Position = UDim2.new(0, 5, 0, 30)
    sideLowLabel.BackgroundTransparency = 1
    sideLowLabel.Font = Enum.Font.Gotham
    sideLowLabel.TextSize = 14
    sideLowLabel.TextColor3 = Color3.fromRGB(220,220,230)
    sideLowLabel.TextXAlignment = Enum.TextXAlignment.Left
    sideLowLabel.Text = "10M-  : 0"
    sideLowLabel.Parent = SideFrame

    sideHighLabel = Instance.new("TextLabel")
    sideHighLabel.Size = UDim2.new(1, -10, 0, 24)
    sideHighLabel.Position = UDim2.new(0, 5, 0, 52)
    sideHighLabel.BackgroundTransparency = 1
    sideHighLabel.Font = Enum.Font.Gotham
    sideHighLabel.TextSize = 14
    sideHighLabel.TextColor3 = Color3.fromRGB(220,220,230)
    sideHighLabel.TextXAlignment = Enum.TextXAlignment.Left
    sideHighLabel.Text = "10M+  : 0"
    sideHighLabel.Parent = SideFrame

    updateSideLabels()

    SideToggle.MouseButton1Click:Connect(function()
        SideFrame.Visible = not SideFrame.Visible
    end)

    return ScreenGui, Frame, Scrolling, UIListLayout
end

local ScreenGui, MainFrame, Scrolling, UIListLayout = createUI()

local function AddPetItem(petName, mps, jobId)
    local Item = Instance.new("Frame")
    Item.Size = UDim2.new(1, -8, 0, 42)
    Item.BackgroundColor3 = Color3.fromRGB(32,40,55)
    Item.BorderSizePixel = 0
    Item.Parent = Scrolling

    local ItemCorner = Instance.new("UICorner")
    ItemCorner.CornerRadius = UDim.new(0, 8)
    ItemCorner.Parent = Item

    local ItemStroke = Instance.new("UIStroke")
    ItemStroke.Thickness = 1
    ItemStroke.Color = Color3.fromRGB(0,200,255)
    ItemStroke.Transparency = 0.15
    ItemStroke.Parent = Item

    local Name = Instance.new("TextLabel")
    Name.Size = UDim2.new(0.55, 0, 1, 0)
    Name.Position = UDim2.new(0, 10, 0, 0)
    Name.BackgroundTransparency = 1
    Name.Text = tostring(petName)
    Name.Font = Enum.Font.GothamMedium
    Name.TextColor3 = Color3.fromRGB(255,255,255)
    Name.TextSize = 14
    Name.TextXAlignment = Enum.TextXAlignment.Left
    Name.Parent = Item

    local Farm = Instance.new("TextLabel")
    Farm.Size = UDim2.new(0.2, 0, 1, 0)
    Farm.Position = UDim2.new(0.55, 0, 0, 0)
    Farm.BackgroundTransparency = 1
    Farm.Text = formatMpsShort(mps) .. "/s"
    Farm.TextColor3 = Color3.fromRGB(180,180,190)
    Farm.Font = Enum.Font.Gotham
    Farm.TextSize = 13
    Farm.Parent = Item

    local Join = Instance.new("TextButton")
    Join.Size = UDim2.new(0.2, -10, 0, 30)
    Join.Position = UDim2.new(0.8, 0, 0.5, -15)
    Join.BackgroundColor3 = Color3.fromRGB(0,140,255)
    Join.Text = "Join"
    Join.TextColor3 = Color3.fromRGB(255,255,255)
    Join.Font = Enum.Font.GothamBold
    Join.TextSize = 14
    Join.AutoButtonColor = true
    Join.Parent = Item

    local JoinCorner = Instance.new("UICorner")
    JoinCorner.CornerRadius = UDim.new(0, 8)
    JoinCorner.Parent = Join

    Join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, LocalPlayer)
    end)
end

--==================================================
-- GET MPS Tá»ª MODEL
--==================================================
local function getMpsFromModel(pet)
    local mpsObj = pet:FindFirstChild("MPS")
    if mpsObj and mpsObj.Value ~= nil then
        local raw = tostring(mpsObj.Value)
        return parseMps(raw), raw
    end

    local bestText = nil
    for _, d in ipairs(pet:GetDescendants()) do
        if d:IsA("TextLabel") or d:IsA("TextButton") then
            local t = d.Text
            if t and t ~= "" then
                local up = t:upper()
                if up:find("/S") or up:find("M/S") or up:find("PERSEC") then
                    bestText = t
                    break
                end
            end
        end
    end

    if bestText then
        return parseMps(bestText), bestText
    end

    return 0, nil
end

--==================================================
-- MAIN LOOP â€“ luÃ´n quÃ©t, chá»‰ brainrot
--==================================================
warn("[PetsFinder] âœ… v9.6 + SideUI started.")

spawn(function()
    while task.wait(3) do
        local jobId   = tostring(game.JobId or "N/A")
        local placeId = game.PlaceId

        local candidates = {}
        local petsFolder = workspace:FindFirstChild("Pets")

        if petsFolder then
            candidates = petsFolder:GetChildren()
        else
            for _, inst in ipairs(workspace:GetChildren()) do
                if inst:IsA("Model") or inst:IsA("Folder") then
                    table.insert(candidates, inst)
                end
            end
        end

        for _, pet in ipairs(candidates) do
            local displayName = detectBrainrotName(pet)
            if not displayName then
                continue -- khÃ´ng pháº£i brainrot
            end

            local mps = select(1, getMpsFromModel(pet))
            if mps < MIN_MPS then
                continue
            end

            local prevBest = bestMpsPerPet[pet] or 0
            if mps <= prevBest then
                -- khÃ´ng tÄƒng MPS => khÃ´ng cáº§n bÃ¡o láº¡i
                continue
            end
            bestMpsPerPet[pet] = mps

            -- cáº­p nháº­t bucket 10M-/10M+
            updateTenMBucket(pet, mps)

            warn(string.format(
                "[PetsFinder] Found %s (Brainrot) | MPS=%d (prev=%d)",
                displayName, mps, prevBest
            ))

            local over50   = (mps > SPLIT_MPS)
            local joinLink = ("https://chillihub1.github.io/chillihub-joiner/?placeId=%s&gameInstanceId=%s")
                :format(placeId, jobId)

            local title = over50
                and "ðŸ”” **Pet >50M Found! (Brainrot)**"
                or  "ðŸ”” **Pet Found! (Brainrot, 1Mâ€“50M)**"

            local content = table.concat({
                title,
                "ðŸ¾ Name: " .. displayName,
                "ðŸ’¸ MPS: " .. formatMpsShort(mps) .. "/s",
                "ðŸ†” Job ID: `" .. jobId .. "`",
                "ðŸŒ [JOIN HERE](" .. joinLink .. ")"
            }, "\n")

            if over50 then
                -- >50M: chá»‰ webhook VIP
                sendWebhook(webhook_over50, { content = content })
            else
                -- 1Mâ€“50M: UI + Auto Join + webhook_high
                AddPetItem(displayName, mps, jobId)

                if autoJoinEnabled and not autoJoinedJobs[jobId] then
                    autoJoinedJobs[jobId] = true
                    pcall(function()
                        TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, LocalPlayer)
                    end)
                end

                sendWebhook(webhook_high, { content = content })
            end
        end
    end
end)
